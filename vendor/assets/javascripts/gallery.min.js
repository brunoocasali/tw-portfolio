var $j = jQuery.noConflict();
var $scroll = 0;
var $window_width = $j(window).width();
var $window_height = $j(window).height();
var sticky_amount = 0;
var next_image;
var prev_image;
var $top_header_height;
$j(document).ready(function() {
    "use strict";
    loadMore();
    prettyPhoto();
    initFlexSlider();
    $j([theme_root + 'img/logo.png']).preload();
    $j('.widget #searchform').mousedown(function() {
        $j(this).addClass('form_focus')
    }).focusout(function() {
        $j(this).removeClass('form_focus')
    });
    $scroll = $j(window).scrollTop();

    initFullScreenTemplate() // necess√°ria
});
$j(window).load(function() {
    "use strict";
    initImageHover();
});

function cleanPortfolioMasXArray($elemXPosArray) {
    var i;
    var length = $elemXPosArray.length;
    var $elemXPosOutArray = [];
    var tmp = {};
    for (i = 0; i < length; i++) {
        tmp[$elemXPosArray[i]] = 0
    }
    for (i in tmp) {
        $elemXPosOutArray.push(i)
    }
    return $elemXPosOutArray
}

function getPortfolioXPos(css) {
    return css.substr(0, css.length - 2)
}

function loadMore() {
    "use strict";
    var i = 1;
    $j('.load_more a').on('click', function(e) {
        e.preventDefault();
        var link = $j(this).attr('href');
        var $content = '.projects_holder';
        var $anchor = '.portfolio_paging .load_more a';
        var $next_href = $j($anchor).attr('href');
        var filler_num = $j('.projects_holder .filler').length;
        var load_more_holder = $j('.portfolio_paging');
        var loading_holder = $j('.portfolio_paging_loading');
        load_more_holder.hide();
        loading_holder.show();
        $j.get(link + '', function(data) {
            $j('.projects_holder .filler').slice(-
                filler_num).remove();
            var $new_content = $j($content, data).wrapInner(
                '').html();
            $next_href = $j($anchor, data).attr('href');
            $j($content, data).waitForImages(function() {
                $j('article.mix:last').after(
                    $new_content);
                if ($j('.masonry_with_space').length) {
                    $j(
                        '.masonry_with_space .projects_holder'
                    ).isotope('reloadItems').isotope()
                } else {
                    var min_height = $j(
                        'article.mix:first').height();
                    $j('article.mix').css(
                        'min-height',
                        min_height);
                    $j('.projects_holder').mixitup(
                        'remix', 'all')
                }
                prettyPhoto();
                if ($j('.load_more').attr('rel') >
                    i) {
                    $j('.load_more a').attr('href',
                        $next_href)
                } else {
                    $j('.load_more').remove()
                }
                $j(
                    '.projects_holder .portfolio_paging:last'
                ).remove();
                $j('article.mix').css('min-height',
                    0);
                load_more_holder.show();
                loading_holder.hide()
            })
        });
        i++
    })
}

function prettyPhoto() {
    "use strict";
    $j('a[data-rel]').each(function() {
        $j(this).attr('rel', $j(this).data('rel'))
    });
    $j("a[rel^='prettyPhoto']").prettyPhoto({
        animation_speed: 'normal',
        slideshow: false,
        autoplay_slideshow: false,
        opacity: 0.80,
        show_title: true,
        allow_resize: true,
        horizontal_padding: 0,
        default_width: 650,
        default_height: 400,
        counter_separator_label: '/',
        theme: 'pp_default',
        hideflash: false,
        wmode: 'opaque',
        autoplay: true,
        modal: false,
        overlay_gallery: false,
        keyboard_shortcuts: true,
        deeplinking: false,
        social_tools: false
    })
}

function initFlexSlider() {
    "use strict";
    $j('.flexslider').each(function() {
        var interval = 8000;
        if (typeof $j(this).data('interval') !== 'undefined' && $j(
            this).data('interval') !== false) {
            interval = parseFloat($j(this).data('interval')) * 1000
        }
        var slideshow = true;
        if (interval === 0) {
            slideshow = false
        }
        var animation = 'slide';
        if (typeof $j(this).data('flex_fx') !== 'undefined' && $j(
            this).data('flex_fx') !== false) {
            animation = $j(this).data('flex_fx')
        }
        $j(this).flexslider({
            animationLoop: true,
            controlNav: false,
            useCSS: false,
            pauseOnAction: true,
            pauseOnHover: true,
            slideshow: slideshow,
            animation: animation,
            prevText: "<div><i class='fa fa-angle-left'></i></div>",
            nextText: "<div><i class='fa fa-angle-right'></i></div>",
            animationSpeed: 600,
            slideshowSpeed: interval,
            start: function() {
                setTimeout(function() {
                    $j(".flexslider").fitVids()
                }, 100)
            }
        });
        $j('.flex-direction-nav a').click(function(e) {
            e.preventDefault();
            e.stopImmediatePropagation();
            e.stopPropagation()
        })
    })
}

var $scrollHeight;

$j.fn.preload = function() {
    "use strict";
    this.each(function() {
        $j('<img/>')[0].src = this
    })
};

var timeOuts = [];

function initImageHover() {
    "use strict";
    if ($j('.image_hover').length) {
        $j('.image_hover').each(function() {
            $j(this).appear(function() {
                var default_visible_time = 300;
                var transition_delay = $j(this).attr(
                    'data-transition-delay');
                var real_transition_delay =
                    default_visible_time + parseFloat(
                        transition_delay);
                var object = $j(this);
                setTimeout(function() {
                    object.addClass('show')
                }, parseFloat(transition_delay));
                setTimeout(function() {
                    object.removeClass('show')
                }, real_transition_delay)
            }, {
                accX: 0,
                accY: -200
            })
        })
    }
}

function initFullScreenTemplate() {
    "use strict";
    if ($j('.full_screen_holder').length && $window_width > 600) {
        $j('.full_screen_preloader').css('height', ($window_height));
        $j('#up_fs_button').on('click', function() {
            $j.fn.fullpage.moveSectionUp();
            return false
        });
        $j('#down_fs_button').on('click', function() {
            $j.fn.fullpage.moveSectionDown();
            return false
        });
        var section_number = $j('.full_screen_inner > .full_screen_section')
            .length;
        $j('.full_screen_inner').fullpage({
            sectionSelector: '.full_screen_section',
            scrollOverflow: true,
            afterLoad: function(anchorLink, index) {
                checkActiveArrowsOnFullScrrenTemplate(
                    section_number, index)
            },
            afterRender: function() {
                checkActiveArrowsOnFullScrrenTemplate(
                    section_number, 1);
                $j('.full_screen_holder').find(
                    '.full_screen_navigation_holder').css(
                    'visibility', 'visible');
                $j('.full_screen_holder').find(
                    '.full_screen_inner').css('visibility',
                    'visible');
                $j('.full_screen_preloader').hide()
            }
        })
    }
}

function checkActiveArrowsOnFullScrrenTemplate(section_number, index) {
    "use strict";
    if (index == '1') {
        $j('.full_screen_navigation_holder.up_arrow').hide()
    } else if (index == section_number) {
        $j('.full_screen_navigation_holder.down_arrow').hide()
    } else {
        $j('.full_screen_navigation_holder.up_arrow').show();
        $j('.full_screen_navigation_holder.down_arrow').show()
    }
}
